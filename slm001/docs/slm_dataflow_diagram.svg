<svg viewBox="0 0 1200 800" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" 
     refX="0" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#2563eb" />
    </marker>
    <linearGradient id="processGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:0.1" />
      <stop offset="100%" style="stop-color:#1d4ed8;stop-opacity:0.2" />
    </linearGradient>
    <linearGradient id="dataGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#10b981;stop-opacity:0.1" />
      <stop offset="100%" style="stop-color:#059669;stop-opacity:0.2" />
    </linearGradient>
  </defs>
  
  <!-- Title -->
  <text x="600" y="30" text-anchor="middle" font-size="24" font-weight="bold" fill="#1f2937">
    Enhanced Local Small Language Model Chatbot - Data Flow
  </text>
  
  <!-- User Input -->
  <rect x="50" y="80" width="120" height="60" rx="10" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
  <text x="110" y="105" text-anchor="middle" font-size="12" font-weight="bold" fill="#92400e">User Input</text>
  <text x="110" y="120" text-anchor="middle" font-size="10" fill="#92400e">(Text Message)</text>
  
  <!-- Command Parser -->
  <rect x="220" y="80" width="120" height="60" rx="10" fill="url(#processGradient)" stroke="#2563eb" stroke-width="2"/>
  <text x="280" y="105" text-anchor="middle" font-size="12" font-weight="bold" fill="#1d4ed8">Command Parser</text>
  <text x="280" y="120" text-anchor="middle" font-size="10" fill="#1d4ed8">Special Commands</text>
  
  <!-- Model Manager -->
  <rect x="390" y="80" width="120" height="60" rx="10" fill="url(#processGradient)" stroke="#2563eb" stroke-width="2"/>
  <text x="450" y="105" text-anchor="middle" font-size="12" font-weight="bold" fill="#1d4ed8">Model Manager</text>
  <text x="450" y="120" text-anchor="middle" font-size="10" fill="#1d4ed8">Load/Switch Models</text>
  
  <!-- Model Selection -->
  <rect x="220" y="180" width="300" height="80" rx="10" fill="url(#dataGradient)" stroke="#059669" stroke-width="2"/>
  <text x="370" y="205" text-anchor="middle" font-size="14" font-weight="bold" fill="#047857">Available Models</text>
  <text x="240" y="225" font-size="10" fill="#047857">• DialoGPT-small (117MB)</text>
  <text x="240" y="240" font-size="10" fill="#047857">• DialoGPT-medium (345MB)</text>
  <text x="240" y="255" font-size="10" fill="#047857">• DialoGPT-large (775MB)</text>
  <text x="390" y="225" font-size="10" fill="#047857">• DistilGPT2 (320MB)</text>
  <text x="390" y="240" font-size="10" fill="#047857">• GPT-2 (500MB)</text>
  
  <!-- Tokenizer -->
  <rect x="590" y="80" width="120" height="60" rx="10" fill="url(#processGradient)" stroke="#2563eb" stroke-width="2"/>
  <text x="650" y="105" text-anchor="middle" font-size="12" font-weight="bold" fill="#1d4ed8">Tokenizer</text>
  <text x="650" y="120" text-anchor="middle" font-size="10" fill="#1d4ed8">Text → Tokens</text>
  
  <!-- Context Builder -->
  <rect x="750" y="80" width="120" height="60" rx="10" fill="url(#processGradient)" stroke="#2563eb" stroke-width="2"/>
  <text x="810" y="105" text-anchor="middle" font-size="12" font-weight="bold" fill="#1d4ed8">Context Builder</text>
  <text x="810" y="120" text-anchor="middle" font-size="10" fill="#1d4ed8">History + Input</text>
  
  <!-- Conversation History -->
  <rect x="750" y="180" width="120" height="80" rx="10" fill="url(#dataGradient)" stroke="#059669" stroke-width="2"/>
  <text x="810" y="205" text-anchor="middle" font-size="12" font-weight="bold" fill="#047857">Conversation</text>
  <text x="810" y="220" text-anchor="middle" font-size="12" font-weight="bold" fill="#047857">History</text>
  <text x="810" y="240" text-anchor="middle" font-size="10" fill="#047857">Last 15 turns</text>
  <text x="810" y="255" text-anchor="middle" font-size="10" fill="#047857">User + Bot pairs</text>
  
  <!-- Language Model -->
  <rect x="920" y="80" width="140" height="60" rx="10" fill="#fee2e2" stroke="#dc2626" stroke-width="2"/>
  <text x="990" y="105" text-anchor="middle" font-size="12" font-weight="bold" fill="#b91c1c">Language Model</text>
  <text x="990" y="120" text-anchor="middle" font-size="10" fill="#b91c1c">Neural Network</text>
  
  <!-- Model Details -->
  <rect x="920" y="180" width="140" height="100" rx="10" fill="url(#dataGradient)" stroke="#059669" stroke-width="2"/>
  <text x="990" y="205" text-anchor="middle" font-size="12" font-weight="bold" fill="#047857">Model Components</text>
  <text x="930" y="225" font-size="9" fill="#047857">• Transformer layers</text>
  <text x="930" y="240" font-size="9" fill="#047857">• Attention mechanisms</text>
  <text x="930" y="255" font-size="9" fill="#047857">• Feed-forward networks</text>
  <text x="930" y="270" font-size="9" fill="#047857">• Embedding layers</text>
  
  <!-- Response Generator -->
  <rect x="750" y="320" width="120" height="60" rx="10" fill="url(#processGradient)" stroke="#2563eb" stroke-width="2"/>
  <text x="810" y="345" text-anchor="middle" font-size="12" font-weight="bold" fill="#1d4ed8">Response</text>
  <text x="810" y="360" text-anchor="middle" font-size="12" font-weight="bold" fill="#1d4ed8">Generator</text>
  
  <!-- Post-processor -->
  <rect x="590" y="320" width="120" height="60" rx="10" fill="url(#processGradient)" stroke="#2563eb" stroke-width="2"/>
  <text x="650" y="345" text-anchor="middle" font-size="12" font-weight="bold" fill="#1d4ed8">Post-processor</text>
  <text x="650" y="360" text-anchor="middle" font-size="10" fill="#1d4ed8">Clean & Format</text>
  
  <!-- Output -->
  <rect x="430" y="320" width="120" height="60" rx="10" fill="#dcfce7" stroke="#16a34a" stroke-width="2"/>
  <text x="490" y="345" text-anchor="middle" font-size="12" font-weight="bold" fill="#15803d">Bot Response</text>
  <text x="490" y="360" text-anchor="middle" font-size="10" fill="#15803d">To User</text>
  
  <!-- Generation Parameters -->
  <rect x="920" y="320" width="140" height="100" rx="10" fill="#f3e8ff" stroke="#7c3aed" stroke-width="2"/>
  <text x="990" y="345" text-anchor="middle" font-size="12" font-weight="bold" fill="#6d28d9">Generation Params</text>
  <text x="930" y="365" font-size="9" fill="#6d28d9">• Temperature: 0.8</text>
  <text x="930" y="380" font-size="9" fill="#6d28d9">• Top-p: 0.9</text>
  <text x="930" y="395" font-size="9" fill="#6d28d9">• Max tokens: 100-150</text>
  <text x="930" y="410" font-size="9" fill="#6d28d9">• Repetition penalty: 1.1</text>
  
  <!-- Device Detection -->
  <rect x="50" y="450" width="200" height="80" rx="10" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
  <text x="150" y="475" text-anchor="middle" font-size="12" font-weight="bold" fill="#92400e">Device Detection</text>
  <text x="60" y="495" font-size="10" fill="#92400e">• CUDA GPU Available?</text>
  <text x="60" y="510" font-size="10" fill="#92400e">• CPU fallback</text>
  <text x="60" y="525" font-size="10" fill="#92400e">• Memory optimization</text>
  
  <!-- Pipeline Configuration -->
  <rect x="290" y="450" width="200" height="80" rx="10" fill="url(#processGradient)" stroke="#2563eb" stroke-width="2"/>
  <text x="390" y="475" text-anchor="middle" font-size="12" font-weight="bold" fill="#1d4ed8">Pipeline Configuration</text>
  <text x="300" y="495" font-size="10" fill="#1d4ed8">• Text generation pipeline</text>
  <text x="300" y="510" font-size="10" fill="#1d4ed8">• Sampling parameters</text>
  <text x="300" y="525" font-size="10" fill="#1d4ed8">• Device mapping</text>
  
  <!-- Error Handling -->
  <rect x="530" y="450" width="200" height="80" rx="10" fill="#fee2e2" stroke="#dc2626" stroke-width="2"/>
  <text x="630" y="475" text-anchor="middle" font-size="12" font-weight="bold" fill="#b91c1c">Error Handling</text>
  <text x="540" y="495" font-size="10" fill="#b91c1c">• Model loading failures</text>
  <text x="540" y="510" font-size="10" fill="#b91c1c">• Generation errors</text>
  <text x="540" y="525" font-size="10" fill="#b91c1c">• Graceful fallbacks</text>
  
  <!-- Performance Monitoring -->
  <rect x="770" y="450" width="200" height="80" rx="10" fill="#e0f2fe" stroke="#0891b2" stroke-width="2"/>
  <text x="870" y="475" text-anchor="middle" font-size="12" font-weight="bold" fill="#0e7490">Performance Monitor</text>
  <text x="780" y="495" font-size="10" fill="#0e7490">• Memory usage tracking</text>
  <text x="780" y="510" font-size="10" fill="#0e7490">• Response time logging</text>
  <text x="780" y="525" font-size="10" fill="#0e7490">• Model statistics</text>
  
  <!-- Data Flow Arrows -->
  <!-- User input flow -->
  <line x1="170" y1="110" x2="220" y2="110" stroke="#2563eb" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="340" y1="110" x2="390" y2="110" stroke="#2563eb" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="510" y1="110" x2="590" y2="110" stroke="#2563eb" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="710" y1="110" x2="750" y2="110" stroke="#2563eb" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="870" y1="110" x2="920" y2="110" stroke="#2563eb" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Model selection -->
  <line x1="450" y1="140" x2="370" y2="180" stroke="#059669" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- History integration -->
  <line x1="810" y1="180" x2="810" y2="140" stroke="#059669" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Response flow -->
  <line x1="990" y1="140" x2="810" y2="320" stroke="#dc2626" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="750" y1="350" x2="710" y2="350" stroke="#2563eb" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="590" y1="350" x2="550" y2="350" stroke="#2563eb" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Generation parameters -->
  <line x1="920" y1="370" x2="870" y2="350" stroke="#7c3aed" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Configuration flows -->
  <line x1="150" y1="450" x2="390" y2="450" stroke="#f59e0b" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="390" y1="450" x2="630" y2="450" stroke="#2563eb" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Feedback loop -->
  <path d="M 490 380 Q 300 600 810 260" stroke="#10b981" stroke-width="2" fill="none" stroke-dasharray="5,5" marker-end="url(#arrowhead)"/>
  <text x="400" y="620" text-anchor="middle" font-size="10" fill="#10b981">History Update Loop</text>
  
  <!-- Legend -->
  <rect x="50" y="700" width="1100" height="80" rx="10" fill="#f9fafb" stroke="#d1d5db" stroke-width="1"/>
  <text x="600" y="720" text-anchor="middle" font-size="14" font-weight="bold" fill="#374151">Data Flow Legend</text>
  
  <rect x="70" y="730" width="15" height="15" fill="#fef3c7" stroke="#f59e0b"/>
  <text x="95" y="742" font-size="11" fill="#374151">Input/User Interface</text>
  
  <rect x="240" y="730" width="15" height="15" fill="url(#processGradient)" stroke="#2563eb"/>
  <text x="265" y="742" font-size="11" fill="#374151">Processing Components</text>
  
  <rect x="420" y="730" width="15" height="15" fill="url(#dataGradient)" stroke="#059669"/>
  <text x="445" y="742" font-size="11" fill="#374151">Data Storage</text>
  
  <rect x="560" y="730" width="15" height="15" fill="#fee2e2" stroke="#dc2626"/>
  <text x="585" y="742" font-size="11" fill="#374151">AI Model Core</text>
  
  <rect x="700" y="730" width="15" height="15" fill="#f3e8ff" stroke="#7c3aed"/>
  <text x="725" y="742" font-size="11" fill="#374151">Configuration</text>
  
  <line x1="850" y1="737" x2="880" y2="737" stroke="#2563eb" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="890" y="742" font-size="11" fill="#374151">Data Flow</text>
  
  <line x1="970" y1="737" x2="1000" y2="737" stroke="#10b981" stroke-width="2" stroke-dasharray="3,3" marker-end="url(#arrowhead)"/>
  <text x="1010" y="742" font-size="11" fill="#374151">Feedback Loop</text>
</svg>